---
layout: post
title: 君子抉第三天（4月20日）
categories:
- 学习笔记
tags: []
published: true
comments: true
---
<p>本来应该在4月20日写的,由于种种原因没有写,今天将它补起来.这是正式的按君子抉中的计划来写博客的第二天,今天搞那个垂直搜索搞了一上午,以前还感觉搞这个有点激情,现在感觉完全是一种累赘,还得写文档,麻烦啊.下午才干了点真正有点意思的东西-----flex.</p>

<p>以前从来没有接触过flex,那次听兴旺说要做一个自动的词法分析器,用flex来实现,研究了半天,最后总算明白了.而且今天我才明白原来编程最痛苦的事不是代码怎么写,而是在哪里编写代码.刚开始在网上搜索了半天,都是讲解flex的程序怎么编写,就是没说,写了在哪里进行编译.最后找了半天,明白了.</p>

<p>先下载flex-2.5.4a-1.exe,然后进行安装,我是安装到了D:GnuWin32,然后在环境变量的path加上一句:  <strong><em>;D:GnuWin32bin</em></strong></p>

<p>再到DOS命令下进行测试安装好了没有,输入 flex -V 即可.这个是大写V.之后就是编写.l文件.编写好.l文件之后,在DOS命令行下定位到你的.l文件的目录,让后输入flex test.l 回车即可.这里test.l是你的.l文件的文件名.让后在test.l文件的同一目录就会生成一个 lex.yy.c.这个文件就可以在Visual Studio中进行编译了.下面这个是我改写的词法分析器的flex的.l文件的代码.
<div style="padding-right: 5px; padding-left: 4px; font-size: 13px; padding-bottom: 4px; width: 98%; word-break: break-all; padding-top: 4px; background-color: #eeeeee; border: #cccccc 1px solid;"><span style="color: #000000;">%</span><span style="color: #000000;">{<br />
#include</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">stdio.h</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">
#include</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">stdlib.h</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">
</span><span style="color: #008000;">/*</span><span style="color: #008000;">保留字</span><span style="color: #008000;">*/</span><span style="color: #000000;">
#include</span><span style="color: #000000;">&lt;</span><span style="color: #0000ff;">string</span><span style="color: #000000;">.h</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">
</span><span style="color: #0000ff;">char</span><span style="color: #000000;"> </span><span style="color: #000000;">*</span><span style="color: #000000;">key[]</span><span style="color: #000000;">=</span><span style="color: #000000;">{</span><span style="color: #800000;">"</span><span style="color: #800000;"> </span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">auto</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">break</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">case</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">char</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">const</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">continue</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">default</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">do</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">double</span><span style="color: #800000;">"</span><span style="color: #000000;">,
</span><span style="color: #800000;">"</span><span style="color: #800000;">else</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">enum</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">extern</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">float</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">for</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">goto</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">if</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">int</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">long</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">register</span><span style="color: #800000;">"</span><span style="color: #000000;">,
</span><span style="color: #800000;">"</span><span style="color: #800000;">return</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">short</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">signed</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">sizeof</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">static</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">struct</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">switch</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">typedef</span><span style="color: #800000;">"</span><span style="color: #000000;">,
</span><span style="color: #800000;">"</span><span style="color: #800000;">union</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">unsigned</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">void</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">volatile</span><span style="color: #800000;">"</span><span style="color: #000000;">,</span><span style="color: #800000;">"</span><span style="color: #800000;">while</span><span style="color: #800000;">"</span><span style="color: #000000;"><span style="color: #000000;">}; </span></span>&nbsp;</div></p>

<p><span style="color: #0000ff;">int</span><span style="color: #000000;"> IsKeyWord(</span><span style="color: #0000ff;">char</span><span style="color: #000000;"> </span><span style="color: #000000;">*</span><span style="color: #000000;">lex) ;</span><span style="color: #008000;">/*</span><span style="color: #008000;"> 判断字符串是否是保留字 </span><span style="color: #008000;">*/</span><span style="color: #0000ff;">void</span><span style="color: #000000;"> print();                            </span><span style="color: #008000;">//</span><span style="color: #008000;">输出token序列；</span><span style="color: #008000;">
</span><span style="color: #0000ff;">void</span><span style="color: #000000;"> main(</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> argc,</span><span style="color: #0000ff;">char</span><span style="color: #000000;">*</span><span style="color: #000000;">argv[]);         </span><span style="color: #008000;">//</span><span style="color: #008000;">主函数；</span><span style="color: #008000;">
</span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> token{                            </span><span style="color: #008000;">//</span><span style="color: #008000;">二元组；</span><span style="color: #008000;">
</span><span style="color: #000000;">      </span><span style="color: #0000ff;">char</span><span style="color: #000000;">*</span><span style="color: #000000;">idproperty;    </span><span style="color: #008000;">//</span><span style="color: #008000;">token属性值；</span><span style="color: #008000;">
</span><span style="color: #000000;">      </span><span style="color: #0000ff;">char</span><span style="color: #000000;">*</span><span style="color: #000000;">idname;    </span><span style="color: #008000;">//</span><span style="color: #008000;">识别的token名字；</span><span style="color: #008000;">
</span><span style="color: #000000;">}entity[</span><span style="color: #800080;">1000</span><span style="color: #000000;">];     </span><span style="color: #008000;">//</span><span style="color: #008000;">定义1000个这样的token，大小可改变；</span><span style="color: #008000;">
</span><span style="color: #0000ff;">char</span><span style="color: #000000;">*</span><span style="color: #000000;">filename;                           </span><span style="color: #008000;">//</span><span style="color: #008000;">保存结果的文件名；</span><span style="color: #008000;">
</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> errnum</span><span style="color: #000000;">=</span><span style="color: #800080;">0</span><span style="color: #000000;">;     </span><span style="color: #008000;">//</span><span style="color: #008000;">错误token的数目；</span><span style="color: #008000;">
</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> value;     </span><span style="color: #008000;">//</span><span style="color: #008000;">属性值int型；</span><span style="color: #008000;">
</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> linenum</span><span style="color: #000000;">=</span><span style="color: #800080;">1</span><span style="color: #000000;">;     </span><span style="color: #008000;">//</span><span style="color: #008000;">行数；</span><span style="color: #008000;">
</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> count</span><span style="color: #000000;">=</span><span style="color: #800080;">0</span><span style="color: #000000;">;     </span><span style="color: #008000;">//</span><span style="color: #008000;">token的个数；</span><span style="color: #008000;">
</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> flag</span><span style="color: #000000;">=</span><span style="color: #800080;">0</span><span style="color: #000000;">;<br />
FILE</span><span style="color: #000000;">*</span><span style="color: #000000;">fpin;     </span><span style="color: #008000;">//</span><span style="color: #008000;">测试文件指针；</span><span style="color: #008000;">
</span><span style="color: #000000;">FILE</span><span style="color: #000000;">*</span><span style="color: #000000;">fpout;     </span><span style="color: #008000;">//</span><span style="color: #008000;">结果文件指针；</span><span style="color: #008000;">
</span><span style="color: #000000;">%</span><span style="color: #000000;">}<br />
digit         [</span><span style="color: #800080;">0</span><span style="color: #000000;">-</span><span style="color: #800080;">9</span><span style="color: #000000;">]<br />
letter        [_a</span><span style="color: #000000;">-</span><span style="color: #000000;">zA</span><span style="color: #000000;">-</span><span style="color: #000000;">Z]<br />
number        {digit}</span><span style="color: #000000;">+</span><span style="color: #000000;">
identifier    {letter}({letter}</span><span style="color: #000000;">|</span><span style="color: #000000;">{digit})</span><span style="color: #000000;">*</span><span style="color: #000000;">
wrongid       ({digit}</span><span style="color: #000000;">+</span><span style="color: #000000;">){letter}({letter}</span><span style="color: #000000;">|</span><span style="color: #000000;">{digit})</span><span style="color: #000000;">*</span><span style="color: #000000;">
newline       [n]<br />
whitespace    [t]</span><span style="color: #000000;">+</span><span style="color: #000000;">
allchar             [</span><span style="color: #000000;">^</span><span style="color: #800080;">0</span><span style="color: #000000;">]</span><span style="color: #000000;">|</span><span style="color: #800080;">0</span><span style="color: #000000;">
string_l            </span><span style="color: #800000;">"</span><span style="color: #800000;">{allchar}?</span><span style="color: #800000;">"</span><span style="color: #000000;">
</span><span style="color: #000000;">%%</span><span style="color: #000000;">
{string_l}        {value</span><span style="color: #000000;">=</span><span style="color: #800080;">6</span><span style="color: #000000;">;print();}                                            </span><span style="color: #008000;">//</span><span style="color: #008000;">字符串常量</span><span style="color: #008000;">
</span><span style="color: #000000;">{identifier}   {value</span><span style="color: #000000;">=</span><span style="color: #000000;">IsKeyWord(yytext); print();}  </span><span style="color: #008000;">//</span><span style="color: #008000;">标识符---0 关键字---1</span><span style="color: #008000;">
</span><span style="color: #000000;">{wrongid}   {value</span><span style="color: #000000;">=</span><span style="color: #800080;">7</span><span style="color: #000000;">;print();}                                        </span><span style="color: #008000;">//</span><span style="color: #008000;">错误标识符</span><span style="color: #008000;">
</span><span style="color: #000000;">{number}   {value</span><span style="color: #000000;">=</span><span style="color: #800080;">2</span><span style="color: #000000;">;print();}                                            </span><span style="color: #008000;">//</span><span style="color: #008000;">数字常量</span><span style="color: #008000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">++</span><span style="color: #800000;">"</span><span style="color: #000000;">         </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">--</span><span style="color: #800000;">"</span><span style="color: #000000;">         </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">-&gt;</span><span style="color: #800000;">"</span><span style="color: #000000;">      </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">&amp;&amp;</span><span style="color: #800000;">"</span><span style="color: #000000;">    </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">||</span><span style="color: #800000;">"</span><span style="color: #000000;">    </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">&lt;=</span><span style="color: #800000;">"</span><span style="color: #000000;">    </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">==</span><span style="color: #800000;">"</span><span style="color: #000000;">       </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">!=</span><span style="color: #800000;">"</span><span style="color: #000000;">    </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">&gt;=</span><span style="color: #800000;">"</span><span style="color: #000000;">    </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">&gt;&gt;</span><span style="color: #800000;">"</span><span style="color: #000000;">    </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">&lt;&lt;</span><span style="color: #800000;">"</span><span style="color: #000000;">    </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">*=</span><span style="color: #800000;">"</span><span style="color: #000000;">    </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">/=</span><span style="color: #800000;">"</span><span style="color: #000000;">    </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">%=</span><span style="color: #800000;">"</span><span style="color: #000000;">      </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">+=</span><span style="color: #800000;">"</span><span style="color: #000000;">    </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">-=</span><span style="color: #800000;">"</span><span style="color: #000000;">    </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">&amp;=</span><span style="color: #800000;">"</span><span style="color: #000000;">    </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">|=</span><span style="color: #800000;">"</span><span style="color: #000000;">    </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">^=</span><span style="color: #800000;">"</span><span style="color: #000000;">                    {value</span><span style="color: #000000;">=</span><span style="color: #800080;">4</span><span style="color: #000000;">;print();}            </span><span style="color: #008000;">/*</span><span style="color: #008000;">组合运算符</span><span style="color: #008000;">*/</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">+</span><span style="color: #800000;">"</span><span style="color: #000000;">            </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">-</span><span style="color: #800000;">"</span><span style="color: #000000;">            </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">*</span><span style="color: #800000;">"</span><span style="color: #000000;">            </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">/</span><span style="color: #800000;">"</span><span style="color: #000000;">         </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">!</span><span style="color: #800000;">"</span><span style="color: #000000;">    </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">%</span><span style="color: #800000;">"</span><span style="color: #000000;">     </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">&amp;</span><span style="color: #800000;">"</span><span style="color: #000000;">     </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">|</span><span style="color: #800000;">"</span><span style="color: #000000;">                   {value</span><span style="color: #000000;">=</span><span style="color: #800080;">3</span><span style="color: #000000;">;print();}                                </span><span style="color: #008000;">/*</span><span style="color: #008000;">基本运算符</span><span style="color: #008000;">*/</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">,</span><span style="color: #800000;">"</span><span style="color: #000000;">            </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">;</span><span style="color: #800000;">"</span><span style="color: #000000;">            </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">{</span><span style="color: #800000;">"</span><span style="color: #000000;">            </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">}</span><span style="color: #800000;">"</span><span style="color: #000000;">            </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">(</span><span style="color: #800000;">"</span><span style="color: #000000;">            </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">)</span><span style="color: #800000;">"</span><span style="color: #000000;">            </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">.</span><span style="color: #800000;">"</span><span style="color: #000000;">            </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">#</span><span style="color: #800000;">"</span><span style="color: #000000;">            </span><span style="color: #000000;">|</span><span style="color: #000000;">
</span><span style="color: #800000;">"</span><span style="color: #800000;">'</span><span style="color: #800000;">"</span><span style="color: #000000;">              {value</span><span style="color: #000000;">=</span><span style="color: #800080;">5</span><span style="color: #000000;">;print();}                </span><span style="color: #008000;">/*</span><span style="color: #008000;">分界符</span><span style="color: #008000;">*/</span><span style="color: #000000;">
{newline}   {linenum</span><span style="color: #000000;">+=</span><span style="color: #800080;">1</span><span style="color: #000000;">;}<br />
{whitespace}   {;}
</span><span style="color: #800000;">"</span><span style="color: #800000;"> </span><span style="color: #800000;">"</span><span style="color: #000000;">    {;}<br />
.    {value</span><span style="color: #000000;">=</span><span style="color: #800080;">7</span><span style="color: #000000;">;print();}                 </span><span style="color: #008000;">/*</span><span style="color: #008000;">其他不识别</span><span style="color: #008000;">*/</span><span style="color: #000000;">
</span><span style="color: #000000;">%%</span><span style="color: #000000;">
</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> yywrap()<br />
{
fclose(fpin);
</span><span style="color: #0000ff;">return</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;"><span style="color: #000000;">;<br />
}</span></span>&nbsp;</p>

<p><span style="color: #0000ff;">void</span><span style="color: #000000;"> print()<br />
{
count</span><span style="color: #000000;">+=</span><span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">if</span><span style="color: #000000;">(flag</span><span style="color: #000000;">!=</span><span style="color: #800080;">1</span><span style="color: #000000;">){
</span><span style="color: #0000ff;">if</span><span style="color: #000000;">((fpout</span><span style="color: #000000;">=</span><span style="color: #000000;">fopen(filename,</span><span style="color: #800000;">"</span><span style="color: #800000;">a</span><span style="color: #800000;">"</span><span style="color: #000000;">))</span><span style="color: #000000;">==</span><span style="color: #000000;">NULL){<br />
printf(</span><span style="color: #800000;">"</span><span style="color: #800000;">无法打开文件! n</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br />
exit(</span><span style="color: #800080;">0</span><span style="color: #000000;">);<br />
}
}
</span><span style="color: #0000ff;">if</span><span style="color: #000000;">(value</span><span style="color: #000000;">&lt;=</span><span style="color: #800080;">6</span><span style="color: #000000;">){
</span><span style="color: #0000ff;">switch</span><span style="color: #000000;">(value){
</span><span style="color: #0000ff;">case</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">:entity[count</span><span style="color: #000000;">-</span><span style="color: #800080;">1</span><span style="color: #000000;">].idproperty</span><span style="color: #000000;">=</span><span style="color: #800000;">"</span><span style="color: #800000;">标识符</span><span style="color: #800000;">"</span><span style="color: #000000;">;</span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">case</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">:entity[count</span><span style="color: #000000;">-</span><span style="color: #800080;">1</span><span style="color: #000000;">].idproperty</span><span style="color: #000000;">=</span><span style="color: #800000;">"</span><span style="color: #800000;">关键字</span><span style="color: #800000;">"</span><span style="color: #000000;">;</span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">case</span><span style="color: #000000;"> </span><span style="color: #800080;">2</span><span style="color: #000000;">:entity[count</span><span style="color: #000000;">-</span><span style="color: #800080;">1</span><span style="color: #000000;">].idproperty</span><span style="color: #000000;">=</span><span style="color: #800000;">"</span><span style="color: #800000;">数字常量</span><span style="color: #800000;">"</span><span style="color: #000000;">;</span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">case</span><span style="color: #000000;"> </span><span style="color: #800080;">3</span><span style="color: #000000;">:entity[count</span><span style="color: #000000;">-</span><span style="color: #800080;">1</span><span style="color: #000000;">].idproperty</span><span style="color: #000000;">=</span><span style="color: #800000;">"</span><span style="color: #800000;">基本运算符</span><span style="color: #800000;">"</span><span style="color: #000000;">;</span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">case</span><span style="color: #000000;"> </span><span style="color: #800080;">4</span><span style="color: #000000;">:entity[count</span><span style="color: #000000;">-</span><span style="color: #800080;">1</span><span style="color: #000000;">].idproperty</span><span style="color: #000000;">=</span><span style="color: #800000;">"</span><span style="color: #800000;">组合运算符</span><span style="color: #800000;">"</span><span style="color: #000000;">;</span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">case</span><span style="color: #000000;"> </span><span style="color: #800080;">5</span><span style="color: #000000;">:entity[count</span><span style="color: #000000;">-</span><span style="color: #800080;">1</span><span style="color: #000000;">].idproperty</span><span style="color: #000000;">=</span><span style="color: #800000;">"</span><span style="color: #800000;">分界符</span><span style="color: #800000;">"</span><span style="color: #000000;">;</span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">case</span><span style="color: #000000;"> </span><span style="color: #800080;">6</span><span style="color: #000000;">:entity[count</span><span style="color: #000000;">-</span><span style="color: #800080;">1</span><span style="color: #000000;">].idproperty</span><span style="color: #000000;">=</span><span style="color: #800000;">"</span><span style="color: #800000;">字符串常量</span><span style="color: #800000;">"</span><span style="color: #000000;">;</span><span style="color: #0000ff;">break</span><span style="color: #000000;">;<br />
}
entity[count</span><span style="color: #000000;">-</span><span style="color: #800080;">1</span><span style="color: #000000;">].idname</span><span style="color: #000000;">=</span><span style="color: #000000;">yytext;<br />
fprintf(fpout,</span><span style="color: #800000;">"</span><span style="color: #800000;">%d &lt; %s , %s &gt; n</span><span style="color: #800000;">"</span><span style="color: #000000;">,count,entity[count</span><span style="color: #000000;">-</span><span style="color: #800080;">1</span><span style="color: #000000;">].idname,entity[count</span><span style="color: #000000;">-</span><span style="color: #800080;">1</span><span style="color: #000000;">].idproperty);<br />
}</span><span style="color: #0000ff;">else</span><span style="color: #000000;">{<br />
errnum</span><span style="color: #000000;">+=</span><span style="color: #800080;">1</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">switch</span><span style="color: #000000;">(value){
</span><span style="color: #0000ff;">case</span><span style="color: #000000;"> </span><span style="color: #800080;">8</span><span style="color: #000000;">:entity[count</span><span style="color: #000000;">-</span><span style="color: #800080;">1</span><span style="color: #000000;">].idproperty</span><span style="color: #000000;">=</span><span style="color: #800000;">"</span><span style="color: #800000;">错误标识符:</span><span style="color: #800000;">"</span><span style="color: #000000;">;</span><span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #0000ff;">case</span><span style="color: #000000;"> </span><span style="color: #800080;">7</span><span style="color: #000000;">:entity[count</span><span style="color: #000000;">-</span><span style="color: #800080;">1</span><span style="color: #000000;">].idproperty</span><span style="color: #000000;">=</span><span style="color: #800000;">"</span><span style="color: #800000;">不识别:</span><span style="color: #800000;">"</span><span style="color: #000000;">;</span><span style="color: #0000ff;">break</span><span style="color: #000000;">;<br />
}
entity[count</span><span style="color: #000000;">-</span><span style="color: #800080;">1</span><span style="color: #000000;">].idname</span><span style="color: #000000;">=</span><span style="color: #000000;">yytext;<br />
fprintf(fpout,</span><span style="color: #800000;">"</span><span style="color: #800000;">%d [line:%d]:%s</span><span style="color: #800000;">"</span><span style="color: #000000;">%</span><span style="color: #000000;">s</span><span style="color: #800000;">"</span><span style="color: #800000;"> n</span><span style="color: #800000;">"</span><span style="color: #000000;">,count,linenum,entity[count</span><span style="color: #000000;">-</span><span style="color: #800080;">1</span><span style="color: #000000;">].idproperty,entity[count</span><span style="color: #000000;">-</span><span style="color: #800080;">1</span><span style="color: #000000;">].idname);<br />
}
</span><span style="color: #0000ff;">if</span><span style="color: #000000;">(flag</span><span style="color: #000000;">!=</span><span style="color: #800080;">1</span><span style="color: #000000;">)fclose(fpout);<br />
}
</span><span style="color: #008000;">/*</span><span style="color: #008000;"> 判断字符串是否是保留字 </span><span style="color: #008000;">*/</span><span style="color: #008000;">/*</span><span style="color: #008000;">    如果不是就返回 0 </span><span style="color: #008000;">*/</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> IsKeyWord(</span><span style="color: #0000ff;">char</span><span style="color: #000000;"> </span><span style="color: #000000;">*</span><span style="color: #000000;">lex)<br />
{
</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i;
</span><span style="color: #0000ff;">for</span><span style="color: #000000;">( i</span><span style="color: #000000;">=</span><span style="color: #800080;">1</span><span style="color: #000000;">;i</span><span style="color: #000000;">&lt;=</span><span style="color: #800080;">32</span><span style="color: #000000;">;i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br />
{
</span><span style="color: #0000ff;">if</span><span style="color: #000000;">(strcmp(lex,key[i]) </span><span style="color: #000000;">==</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">)
</span><span style="color: #0000ff;">return</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">;<br />
}
</span><span style="color: #0000ff;">return</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">;<br />
}
</span><span style="color: #0000ff;">void</span><span style="color: #000000;"> main(</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> argc,</span><span style="color: #0000ff;">char</span><span style="color: #000000;">*</span><span style="color: #000000;">argv[])<br />
{
</span><span style="color: #0000ff;">if</span><span style="color: #000000;">(argc</span><span style="color: #000000;">==</span><span style="color: #800080;">1</span><span style="color: #000000;">){<br />
printf(</span><span style="color: #800000;">"</span><span style="color: #800000;">please input the C program(ctrl+z to end) n</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br />
flag</span><span style="color: #000000;">=</span><span style="color: #800080;">1</span><span style="color: #000000;">;<br />
fpin</span><span style="color: #000000;">=</span><span style="color: #000000;">stdin;<br />
fpout</span><span style="color: #000000;">=</span><span style="color: #000000;">stdout;<br />
}
</span><span style="color: #0000ff;">if</span><span style="color: #000000;">(argc</span><span style="color: #000000;">==</span><span style="color: #800080;">2</span><span style="color: #000000;">)argv[</span><span style="color: #800080;">2</span><span style="color: #000000;">]</span><span style="color: #000000;">=</span><span style="color: #800000;">"</span><span style="color: #800000;">defresult.txt</span><span style="color: #800000;">"</span><span style="color: #000000;">;<br />
filename</span><span style="color: #000000;">=</span><span style="color: #000000;">argv[</span><span style="color: #800080;">2</span><span style="color: #000000;">];
</span><span style="color: #0000ff;">if</span><span style="color: #000000;">(flag</span><span style="color: #000000;">!=</span><span style="color: #800080;">1</span><span style="color: #000000;">){
</span><span style="color: #0000ff;">if</span><span style="color: #000000;">((fpin</span><span style="color: #000000;">=</span><span style="color: #000000;">fopen(argv[</span><span style="color: #800080;">1</span><span style="color: #000000;">],</span><span style="color: #800000;">"</span><span style="color: #800000;">r</span><span style="color: #800000;">"</span><span style="color: #000000;">))</span><span style="color: #000000;">==</span><span style="color: #000000;">NULL){<br />
printf(</span><span style="color: #800000;">"</span><span style="color: #800000;">cannot open the file n</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br />
exit(</span><span style="color: #800080;">0</span><span style="color: #000000;">);<br />
}
}<br />
yyin</span><span style="color: #000000;">=</span><span style="color: #000000;">fpin;<br />
yylex();
</span><span style="color: #0000ff;">if</span><span style="color: #000000;">(flag</span><span style="color: #000000;">!=</span><span style="color: #800080;">1</span><span style="color: #000000;">){
</span><span style="color: #0000ff;">if</span><span style="color: #000000;">((fpout</span><span style="color: #000000;">=</span><span style="color: #000000;">fopen(filename,</span><span style="color: #800000;">"</span><span style="color: #800000;">a</span><span style="color: #800000;">"</span><span style="color: #000000;">))</span><span style="color: #000000;">==</span><span style="color: #000000;">NULL){<br />
printf(</span><span style="color: #800000;">"</span><span style="color: #800000;">cannot write the file n</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br />
exit(</span><span style="color: #800080;">0</span><span style="color: #000000;">);<br />
}
}<br />
fprintf(fpout,</span><span style="color: #800000;">"</span><span style="color: #800000;">n</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br />
fprintf(fpout,</span><span style="color: #800000;">"</span><span style="color: #800000;">%d symbol(s) found. n %d error(s) found. n</span><span style="color: #800000;">"</span><span style="color: #000000;">,count,errnum);<br />
fprintf(fpout,</span><span style="color: #800000;">"</span><span style="color: #800000;">======================================================================= n</span><span style="color: #800000;">"</span><span style="color: #000000;">);
</span><span style="color: #0000ff;">if</span><span style="color: #000000;">(flag</span><span style="color: #000000;">!=</span><span style="color: #800080;">1</span><span style="color: #000000;"><span style="color: #000000;">)fclose(fpout);<br />
yywrap();</span></span>}</p>

<p>
&nbsp;</p>

<p><a href="http://www.cnblogs.com/images/cnblogs_com/DonePuzzle/WindowsLiveWriter/420_13C34/image004_2.jpg"><img style="border: 0px;" alt="image004" src="http://www.cnblogs.com/images/cnblogs_com/DonePuzzle/WindowsLiveWriter/420_13C34/image004_thumb.jpg" width="342" height="345" border="0" /></a> <a href="http://www.cnblogs.com/images/cnblogs_com/DonePuzzle/WindowsLiveWriter/420_13C34/image002_2.jpg"><img style="border: 0px;" alt="image002" src="http://yanggang.me/images/daijun/wp-content/uploads/2013/05/image002_thumb.jpg" width="379" height="340" border="0" /></a></p>
